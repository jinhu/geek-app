<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<script src="/bower_components/webcomponentsjs/webcomponents-lite.min.js"></script>
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/paper-styles/demo-pages.html">
<link rel="import" href="../bower_components/iron-flex-layout/classes/iron-flex-layout.html">
<link rel="import" href="geek-panel.html">

<dom-module id="geek-board">
  <template>

    <paper-material elevation="1" class="horizontal layout">

      <geek-panel
        title="To do"
        src="{{src}}"
        status="to_do"
        on-click="transfer"
        on-track="handleTrack"
        next_status="in_progress">

      </geek-panel>
      <geek-panel
        title="In progress"
        src="{{src}}"
        status="in_progress"
        on-click="transfer"
        on-track="handleTrack"
        next_status="done">

      </geek-panel>
      <geek-panel title="Done"
                  src="{{src}}" status="done" on-click="transfer" next_status="hide"></geek-panel>
    </paper-material>
    <iron-ajax
      id="request"
      url=""
      handle-as="json"
      on-response="transfered">
    </iron-ajax>

  </template>

  <script>
    (function() {
      'use strict';

      Polymer({
        is: 'geek-board',

        transfer: function(e) {
          this.$.request.url = this.src + '/' + e.target.id;
          this.$.request.params = {status: e.target.textContent};
          //this.$.request.method="put";
          this.$.request.generateRequest();
          var card = e.target.parentNode;
          card.parentNode.removeChild(card);
        },

        transfered: function() {
        },

        handleTrack: function(e) {
        switch (e.detail.state) {
          case 'start':
            this.message = 'Tracking started!';
            break;
          case 'track':
            this.message = 'Tracking in progress... ' + e.detail.x + ', ' + e.detail.y;
            e.target.style.transform = e.target.style.webkitTransform =
              'translate(' + e.detail.x + 'px, ' + e.detail.y + 'px)';
            break;
          case 'end':
            this.message = 'Tracking ended!';
            //parent = e.detail.hover();
            //parent.appendChild(e.target);
            break;
        }
      }
      });
    })();
  </script>

</dom-module>
